<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eLearnPlayer.mapper.ReadingPassagesInfoMapper">
  <resultMap id="BaseResultMap" type="com.eLearnPlayer.entity.ReadingPassagesInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="Passage_id" jdbcType="INTEGER" property="passageId" />
    <result column="Passage_title" jdbcType="VARCHAR" property="passageTitle" />
    <result column="Level" jdbcType="INTEGER" property="level" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.eLearnPlayer.entity.ReadingPassagesInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="Passage_text" jdbcType="LONGVARCHAR" property="passageText" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    Passage_id, Passage_title, Level
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    Passage_text
  </sql>
    <insert id="insertReadingPassage">
      INSERT INTO reading_passages_info (Passage_title, Passage_text, Level)
      VALUES (#{passageTitle}, #{passageText}, #{level})
    </insert>
  <insert id="insertReadingQuestion">
    INSERT INTO reading_questions_info (Passage_id,Passage_text,correct_answer)
    VALUES (#{passageId}, #{passageText}, #{correctAnswer})
  </insert>
  <insert id="insertReadingChoice">
    INSERT INTO reading_choices_info (Reading_Question_id,Choice_index,Choice_text)
    VALUES (#{readingQuestionId}, #{choiceIndex}, #{choiceText})
  </insert>
  <select id="findAllWithGrade" resultType="com.eLearnPlayer.entity.ReadingPassagesInfoWithGrade">
    SELECT r.Passage_id,r.Passage_title,r.Passage_text,r.Level,l.Grade
    FROM
      Reading_Passages_info r
        JOIN
      Level_info l
      ON
        r.Level = l.Level
  </select>




  <select id="getPassageBySelectedRankAndLevel" resultType="com.eLearnPlayer.entity.ReadingPassagesInfo">
    SELECT * FROM reading_passages_info
    WHERE Level = #{level}
      AND Passage_id = (SELECT Passage_id
        FROM (SELECT Passage_id FROM reading_passages_info WHERE Level = #{level} LIMIT #{selectedRank}, 1) AS tmp)
  </select>
  <select id="getQuestionsByPassageId" resultType="com.eLearnPlayer.entity.ReadingQuestionsInfo">
    SELECT * FROM reading_questions_info WHERE Passage_id = #{passageId}
  </select>
  <select id="getChoicesByQuestions" resultType="com.eLearnPlayer.entity.ReadingChoicesInfo">
    SELECT * FROM reading_choices_info WHERE reading_question_id IN
    <foreach item="question" collection="list" open="(" separator="," close=")">
      #{question.readingQuestionId}
    </foreach>
  </select>
  <select id="getLevelInfoByLevel" resultType="com.eLearnPlayer.entity.LevelInfo">
    SELECT * FROM level_info WHERE level = #{level}
  </select>
  <select id="getPassageByPassageId" resultType="com.eLearnPlayer.entity.ReadingPassagesInfo">
    SELECT * FROM reading_passages_info WHERE Passage_id = #{passageId}
  </select>
  <select id="getPassageIdByPassageTitle" resultType="java.lang.Integer">
    SELECT Passage_id
    FROM reading_passages_info
    WHERE Passage_title = #{passageTitle}
  </select>
  <select id="getReadingQuestionIdByPassageText" resultType="java.lang.Integer">
    SELECT Reading_Question_id
    FROM reading_questions_info
    WHERE Passage_text = #{passageText}
  </select>


</mapper>